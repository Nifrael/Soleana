---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import type { PrestationData } from "../../types/prestation";

import Layout from "../../layouts/Layout.astro";
import PageHero from "../../components/global/PageHero.astro";
import PriceTable from "../../components/prestations/PriceTable.astro";
import ContactCard from "../../components/global/ContactCard.astro";
import StructureCard from "../../components/global/StructuresCards.astro";

export async function getStaticPaths() {
  const prestations = await getCollection("prestations");
  return prestations.map((prestation) => {
    const slug = prestation.id.split(".")[0];
    return {
      params: { slug },
      props: {
        prestationData: prestation.data,
      },
    };
  });
}

const { prestationData } = Astro.props;

const partenaires = await getCollection("partenaires");
const partenaire = partenaires[0].data;
---

<Layout title={`Soleana | ${prestationData.title}`}>
  <PageHero
    imageDesktop={prestationData.image.src}
    imageMobile={prestationData.image.src}
    altText={`Photo d'accueil de la section ${prestationData.title}`}
    title={prestationData.title}
    subtitle={prestationData.subtitle}
  />
  <div class="page-content">
    <h1>"{prestationData.quote}"</h1>
    <Image
      id="icon"
      src={prestationData.icon.src}
      alt={`IcÃ´ne de ${prestationData.title}`}
    />

    <PriceTable
      title={prestationData.priceTableTitle}
      items={prestationData.prices}
    />

    {
      prestationData.pageLayout === "structures" && partenaire && (
        <StructureCard
          name={partenaire.name}
          location={partenaire.location}
          websiteUrl={partenaire.websiteUrl}
          description={partenaire.description}
        />
      )
    }

    {
      prestationData.secondPrices && (
        <PriceTable
          title={prestationData.secondPriceTableTitle}
          items={prestationData.secondPrices}
        />
      )
    }

    {
      prestationData.thirdPrices && (
        <PriceTable
          title={prestationData.thirdPriceTableTitle}
          items={prestationData.thirdPrices}
        />
      )
    }

    {
      prestationData.fourthPrices && (
        <PriceTable
          title={prestationData.fourthPriceTableTitle}
          items={prestationData.fourthPrices}
        />
      )
    }
  </div>
  <ContactCard />
</Layout>

<style lang="scss">
  @use "../../styles/global.scss";

  .page-content {
    max-width: 90vw;
    margin: 95vh auto 0 auto;
    padding-bottom: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    h1 {
      text-align: center;
      padding-top: 1rem;
      margin-bottom: 0;
      font-style: italic;
    }
    img {
      width: 30px;
      justify-self: center;
    }
  }
</style>
